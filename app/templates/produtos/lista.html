{% extends "base.html" %}

{% block conteudo %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Catálogo de Produtos</h2>

    {% if current_user.is_authenticated and current_user.tipo_usuario == 'produtor' %}
    <a href="{{ url_for('produtos.novo_produto') }}" class="btn-primary"
        style="background:green; color:white; padding:5px 10px; text-decoration:none;">
        + Novo Produto
    </a>
    {% endif %}
</div>

{% if produtos %}
<ul style="list-style: none; padding: 0;">
    {% for p in produtos %}
    <li style="border: 1px solid #ddd; margin-bottom: 10px; padding: 10px; border-radius: 5px;">
        <div style="display: flex; justify-content: space-between;">
            <div>
                <strong>{{ p.nome }}</strong>
                <span style="color: #666; font-size: 0.9em;">({{ p.categoria.nome }})</span>
                <br>
                Preço: R$ {{ "%.2f"|format(p.preco) }} / {{ p.unidade }}
                <br>
                <small>Produtor: {{ p.produtor.nome }} | Estoque: {{ p.estoque }}</small>
            </div>

            {% if current_user.is_authenticated and (current_user.tipo_usuario == 'admin' or (current_user.produtor and
            current_user.produtor.id == p.produtor_id)) %}
            <div>
                <a href="{{ url_for('produtos.editar_produto', id=p.id) }}"
                    style="color: blue; margin-right: 10px;">Editar</a>
                <a href="{{ url_for('produtos.deletar_produto', id=p.id) }}" style="color: red;"
                    onclick="return confirm('Tem certeza que deseja excluir?');">Excluir</a>
            </div>
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>Nenhum produto cadastrado ainda.</p>
{% endif %}

{% endblock %}