{% extends "base.html" %}

{% block conteudo %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">Painel do Produtor</h2>
        <small class="text-muted">Bem-vindo, {{ current_user.produtor.nome }}.</small>
    </div>
    <div class="d-flex gap-2">
        <a href="{{ url_for('produtos.novo_produto') }}" class="btn btn-success">Cadastrar Novo Produto</a>
        <a href="{{ url_for('produtor.ver_perfil') }}" class="btn btn-outline-secondary">Ver Meu Perfil</a>
    </div>
</div>

<hr>

<div class="card mb-4 border-0 shadow-sm bg-light">
    <div class="card-body">
        <h4 class="card-title text-primary"><i class="bi bi-graph-up"></i> Relat√≥rio de Desempenho</h4>
        <p class="mb-3">Faturamento Total: <strong class="text-success fs-4">R$ {{ "%.2f"|format(faturamento_total)
                }}</strong></p>

        <h6 class="text-muted text-uppercase small fw-bold">Vendas por Produto:</h6>
        {% if vendas_por_produto %}
        <div class="table-responsive bg-white rounded border">
            <table class="table table-sm mb-0 table-hover">
                <thead class="table-light">
                    <tr>
                        <th class="ps-3">Produto</th>
                        <th>Qtd Vendida</th>
                        <th class="text-end pe-3">Total Arrecadado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in vendas_por_produto %}
                    <tr>
                        <td class="ps-3">{{ item.nome }}</td>
                        <td>{{ item.total_qtd }}</td>
                        <td class="text-end pe-3 text-success fw-bold">R$ {{ "%.2f"|format(item.total_valor) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted small mb-0">Ainda n√£o h√° dados suficientes para gerar relat√≥rios detalhados.</p>
        {% endif %}
    </div>
</div>

<h4>Meus Produtos Cadastrados</h4>
{% if meus_produtos %}
<ul class="list-group mb-4 shadow-sm">
    {% for p in meus_produtos %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <strong>{{ p.nome }}</strong>
            <div class="small text-muted">R$ {{ "%.2f"|format(p.preco) }}</div>
        </div>
        <div>
            <a href="{{ url_for('produtos.editar_produto', id=p.id) }}"
                class="btn btn-sm btn-outline-primary">Editar</a>
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<div class="alert alert-info">Voc√™ ainda n√£o tem produtos. Cadastre o primeiro acima!</div>
{% endif %}

<hr>

<h4>üì¶ Minhas Vendas Recebidas</h4>

{% if minhas_vendas %}
<div class="table-responsive shadow-sm border rounded">
    <table class="table mb-0 table-hover">
        <thead class="table-light">
            <tr>
                <th>Data</th>
                <th>Produto</th>
                <th>Qtd</th>
                <th>Valor Total</th>
                <th>Comprador</th>
                <th>Status Pedido</th>
            </tr>
        </thead>
        <tbody>
            {% for item in minhas_vendas %}
            <tr>
                <td>{{ item.pedido.data.strftime('%d/%m/%Y') }}</td>
                <td>{{ item.produto.nome }}</td>
                <td>{{ item.quantidade }} {{ item.produto.unidade }}</td>
                <td class="text-success fw-bold">R$ {{ "%.2f"|format(item.preco_unitario * item.quantidade) }}</td>
                <td>
                    {{ item.pedido.cliente.nome }}<br>
                    <small class="text-muted">{{ item.pedido.cliente.telefone or 'Sem telefone' }}</small>
                </td>
                <td><span class="badge bg-secondary">{{ item.pedido.status }}</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-warning">Nenhuma venda realizada ainda.</div>
{% endif %}
{% endblock %}