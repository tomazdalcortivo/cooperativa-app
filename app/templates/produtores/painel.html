{% extends "base.html" %}

{% block conteudo %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="mb-0">Painel do Produtor</h2>
        <small class="text-muted">Bem-vindo, {{ current_user.produtor.nome }}.</small>
    </div>
    <div class="d-flex gap-2">
        <a href="{{ url_for('produtos.novo_produto') }}" class="btn btn-success">Cadastrar Novo Produto</a>
        <a href="{{ url_for('produtor.perfil') }}" class="btn btn-outline-secondary">Gerenciar Perfil</a>
    </div>
</div>

<hr>

<h4>Meus Produtos Cadastrados</h4>
{% if meus_produtos %}
<ul class="list-group mb-4">
    {% for p in meus_produtos %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <strong>{{ p.nome }}</strong>
            <div class="small text-muted">R$ {{ "%.2f"|format(p.preco) }}</div>
        </div>
        <div>
            <a href="{{ url_for('produtos.editar_produto', id=p.id) }}" class="btn btn-sm btn-outline-primary">Editar</a>
        </div>
    </li>
    {% endfor %}
    </ul>
{% else %}
<p>VocÃª ainda nÃ£o tem produtos.</p>
{% endif %}

<hr>

<h4>ðŸ“¦ Minhas Vendas Recebidas</h4>

{% if minhas_vendas %}
<div class="table-responsive">
    <table class="table">
        <thead class="table-light">
            <tr>
                <th>Data</th>
                <th>Produto</th>
                <th>Qtd</th>
                <th>Valor Total</th>
                <th>Comprador</th>
                <th>Status Pedido</th>
            </tr>
        </thead>
        <tbody>
            {% for item in minhas_vendas %}
            <tr>
                <td>{{ item.pedido.data.strftime('%d/%m/%Y') }}</td>
                <td>{{ item.produto.nome }}</td>
                <td>{{ item.quantidade }} {{ item.produto.unidade }}</td>
                <td class="text-success">R$ {{ "%.2f"|format(item.preco_unitario * item.quantidade) }}</td>
                <td>{{ item.pedido.cliente.nome }}<br><small class="text-muted">{{ item.pedido.cliente.telefone or 'Sem telefone' }}</small></td>
                <td><span class="badge bg-secondary">{{ item.pedido.status }}</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-warning">Nenhuma venda realizada ainda.</div>
{% endif %}
{% endblock %}